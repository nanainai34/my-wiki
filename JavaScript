document.addEventListener('DOMContentLoaded', function() {
    const sections = ['history', 'government', 'culture'];

    sections.forEach(section => {
        loadComments(section);
        const form = document.getElementById(`${section}-form`);
        if (form) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                try {
                    addComment(section);
                } catch (error) {
                    console.error(`Error adding comment to section: ${section}`, error);
                }
            });
        }
    });
});

function loadComments(section) {
    try {
        const panel = document.getElementById(`${section}-panel`);
        if (panel) {
            panel.innerHTML = '';
            const comments = JSON.parse(localStorage.getItem(`${section}-comments`)) || [];
            comments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.classList.add('comment');
                commentElement.innerHTML = `<strong>${comment.name}:</strong> ${comment.text}`;
                panel.appendChild(commentElement);
            });
        }
    } catch (error) {
        console.error(`Error loading comments for section: ${section}`, error);
    }
}

function addComment(section) {
    console.log(`Adding comment to section: ${section}`);
    const nameInput = document.getElementById(`${section}-name`);
    const commentInput = document.getElementById(`${section}-comment`);

    const name = nameInput.value;
    const text = commentInput.value;

    if (!name || !text) return;

    try {
        const comments = JSON.parse(localStorage.getItem(`${section}-comments`)) || [];
        comments.push({ name, text });
        localStorage.setItem(`${section}-comments`, JSON.stringify(comments));

        nameInput.value = '';
        commentInput.value = '';

        loadComments(section);
        console.log(`Comment added to section: ${section}`);
    } catch (error) {
        console.error(`Error adding comment to section: ${section}`, error);
    }
}
